<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <title>Checklist de Inspeção</title>
  <style>
    /* --- ESTILOS DO CABEÇALHO --- */
    @page {
      size: A4;
      margin: 1.5cm;
    }
    body { font-family: 'Montserrat', sans-serif; font-size: 10pt; color: #333; }
    h1 { font-size: 14pt; text-align: center; margin-bottom: 20px; text-transform: uppercase; }
    .header-info, .general-info {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 20px;
    }
    .header-info p, .general-info p { margin: 4px 0; }
    h2 { font-size: 10pt; background-color: #f2f2f2; padding: 8px; margin-top: 20px; margin-bottom: 10px; }

    /* --- ESTILOS DO CHECKLIST --- */
    .section-item { border-bottom: 1px solid #eee; padding: 5px 0 5px 15px; }
    .section-item-na { font-style: italic; color: #888; }

    /* --- ESTILOS DAS ASSINATURAS --- */
    .signatures {
      margin-top: 40px;
      width: 100%;
      page-break-inside: avoid;
      text-align: center;
    }
    .signatures table {
      width: 100%;
      margin: 0 auto;
      border-collapse: collapse;
      table-layout: fixed;
    }
    .signature-td {
      width: 50%;
      vertical-align: top;
      text-align: center;
      padding: 0 10px;
    }

    /* container interno fixo para consistência no PDF */
    .sig-inner {
      display: inline-block;
      width: 240px; /* largura fixa para consistência */
      text-align: center;
    }

    .sig-inner img {
      display: block;
      margin: 0 auto 6px auto;
      max-height: 80px; /* ajuste conforme necessidade de qualidade */
      max-width: 100%;
      height: auto;
    }

    .signature-line {
      display: block;
      width: 80%;
      border-top: 1px solid #333;
      margin: 6px auto 8px auto;
    }

    .signature-cell-wrapper {
      max-width: 240px;
      margin: 0 auto;
      padding-top: 0; /* sem padding-top para não deslocar o conteúdo */
      text-align: center;
    }

    /* pequenos ajustes tipográficos */
    .signature-cell-wrapper p { margin: 0; }
    .signature-cell-wrapper p.meta { font-size: 9pt; margin-top: 2px; color: #222; }
    .signature-cell-wrapper p.submeta { font-size: 8pt; margin-top: 4px; color: #666; }

  </style>
</head>
<body>

<h1>CHECK-LIST DE INSPEÇÃO DE SEGURANÇA DO TRABALHO</h1>

<div class="header-info">
  <p><strong>Empresa:</strong> <span th:text="${generatingCompanyName}"></span></p>
  <p><strong>CNPJ:</strong> <span th:text="${generatingCompanyCnpj}"></span></p>
</div>

<div class="general-info">
  <p><strong>Empresa Cliente:</strong> <span th:text="${report.company?.name}"></span></p>
  <p><strong>CNPJ:</strong> <span th:text="${report.company?.cnpj}"></span></p>
  <p th:if="${report.unit != null}"><strong>Unidade:</strong> <span th:text="${report.unit.name}"></span></p>
  <p th:if="${report.sector != null}"><strong>Setor:</strong> <span th:text="${report.sector.name}"></span></p>
  <p><strong>Local da Inspeção:</strong> <span th:text="${report.local}"></span></p>
  <p><strong>Data da inspeção:</strong> <span th:text="${#temporals.format(report.inspectionDate, 'dd/MM/yyyy')}"></span></p>
</div>

<div class="general-info">
  <p><strong>Responsável:</strong> <span th:text="${report.technician?.name}"></span></p>
  <p><strong>Sigla Conselho:</strong> <span th:text="${report.responsavelSigla}"></span></p>
  <p><strong>Registro Conselho:</strong> <span th:text="${report.responsavelRegistro}"></span></p>
  <p><strong>Especialidade:</strong> <span th:text="${report.technician?.especialidade}"></span></p>
</div>

<h2>CHECK LIST</h2>

<div th:each="section, iterStat : ${report.sections}">
  <h3 th:text="${(iterStat.index + 1) + '. ' + section.title + (section.na ? ' - (Não se Aplica)' : '')}" style="font-size: 11pt;"></h3>

  <div th:unless="${section.na}" style="margin-bottom: 15px;">
    <div th:each="item, itemStat : ${section.items}" class="section-item">
      <span th:text="${(iterStat.index + 1) + '.' + (itemStat.index + 1) + ' - ' + item.description}"></span> -
      <strong>
        <span th:if="${item.na}" class="section-item-na">Não se aplica</span>
        <span th:unless="${item.na}" th:text="${item.checked ? 'Sim' : 'Não'}"></span>
      </strong>
    </div>
  </div>
</div>

<div style="page-break-before: auto;">
  <h2 class="notes-header">Anotações</h2>
  <p th:text="${report.notes}" style="padding-left: 5px; white-space: pre-wrap;">...</p>

  <h2 class="notes-header">Observações</h2>
  <p th:text="${report.observations}" style="padding-left: 5px; white-space: pre-wrap;">...</p>
</div>

<div class="signatures">
  <table>
    <tbody>
    <tr>
      <td class="signature-td">
        <div class="sig-inner">
          <img th:if="${report.technicianSignatureImageBase64}"
               th:src="'data:image/png;base64,' + ${report.technicianSignatureImageBase64}"
               alt="Assinatura do Técnico" />
          <span class="signature-line"></span>

          <div class="signature-cell-wrapper">
            <p th:text="${report.technician?.name}" style="font-weight: bold;"></p>
            <p th:if="${report.responsavelRegistro != null and !report.responsavelRegistro.isEmpty()}"
               class="meta"
               th:text="${report.responsavelRegistro + ' | ' + report.responsavelSigla}"></p>
            <p th:if="${report.technician?.especialidade != null and !report.technician.especialidade.isEmpty()}"
               class="meta"
               th:text="${report.technician.especialidade}"></p>
            <p th:if="${report.technicianSignedAt != null}" class="submeta"
               th:text="${'Assinado em: ' + #temporals.format(report.technicianSignedAt, 'dd/MM/yyyy HH:mm:ss')}"></p>
          </div>
        </div>
      </td>

      <td class="signature-td">
        <div class="sig-inner">
          <img th:if="${report.clientSignatureImageBase64}"
               th:src="'data:image/png;base64,' + ${report.clientSignatureImageBase64}"
               alt="Assinatura do Cliente" />
          <span class="signature-line"></span>

          <div class="signature-cell-wrapper">
            <p th:text="${report.clientSignerName}" style="font-weight: bold;"></p>
            <p class="meta">Cliente</p>
            <p th:if="${report.clientSignedAt != null}" class="submeta">
              <span th:text="${'Assinado em: ' + #temporals.format(report.clientSignedAt, 'dd/MM/yyyy HH:mm:ss')}" style="display:block;"></span>
              <span th:if="${report.clientSignatureLatitude != null}" th:text="${'Lat ' + report.clientSignatureLatitude + ', Lon ' + report.clientSignatureLongitude}" style="display:block; margin-top:2px;"></span>
            </p>
          </div>
        </div>
      </td>
    </tr>
    </tbody>
  </table>
</div>

</body>
</html>